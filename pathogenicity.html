<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTFâ€‘8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>VirTransformer â€“ Predict Pathogenicity</title>
  <style>
    body{margin:0;padding:1rem;font-family:sans-serif;background:#f9fbfc;color:#333;}
    textarea{width:100%;height:8rem;padding:.5rem;font-size:1rem;}
    button{padding:.7rem 1.5rem;background:#0c2a4d;color:#fff;border:none;cursor:pointer;margin-top:.5rem;}
    pre{background:#eef;padding:1rem;margin-top:1rem;white-space:pre-wrap;word-wrap:break-word;}
  </style>
</head>
<body>
  <h2>ðŸ§¬ VirTransformer</h2>
  <textarea id="dnaInput" placeholder="Enter DNA sequenceâ€¦"></textarea><br>
  <button id="runBtn">Run Prediction</button>
  <h3>Results</h3>
  <pre id="output">Awaiting your inputâ€¦</pre>

  <script>
    const SPACE_URL = "https://rajaatif786-vhbert.hf.space";

    async function runInference() {
      const seq = dnaInput.value.trim();
      if (!seq) return alert("Please enter a DNA sequence.");
      output.innerText = "Running inferenceâ€¦";

      // Step 1: POST to /call/predict
      const post = await fetch(`${SPACE_URL}/call/predict`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: [seq] })
      });
      if (!post.ok) {
        output.innerText = `POST error: ${post.status}`;
        return;
      }
      const { event_id } = await post.json();

      // Step 2: GET the results stream
      const get = await fetch(`${SPACE_URL}/call/predict/${event_id}`);
      if (!get.ok) {
        output.innerText = `GET error: ${get.status}`;
        return;
      }
      const text = await get.text();
      // Extract data JSON after "data: "
      const match = text.match(/data:\s*(\[[^\]]*\])/);
      if (!match) return output.innerText = "Response parse error";

      const result = JSON.parse(match[1]);
      output.innerText = JSON.stringify(result, null, 2);
    }

    runBtn.onclick = runInference;
  </script>
</body>
</html>
